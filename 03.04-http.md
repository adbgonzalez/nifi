# 03.04 Procesadores HTTP en Apache NiFi

Integración con APIs REST, microservizos e servizos web.

---

# 8. Procesadores HTTP — Integración de servizos

Inclúe:
- InvokeHTTP (cliente HTTP)
- HandleHttpRequest / HandleHttpResponse (servidor HTTP)
- ListenHTTP (endpoints simples)
- FetchHTTP (descarga)
- PostHTTP / PutHTTP (alternativas)

---

## 8.1. InvokeHTTP

### 1. Descrición
Cliente HTTP universal de NiFi para consumir APIs REST (GET, POST, PUT, DELETE…).

### 2. Función principal
- Consultar APIs públicas.
- Integración con servizos internos.
- Enviar JSON, texto ou ficheiros.
- Autenticación: Basic, Headers, Tokens…

### 3. Propiedades principais
| Propiedade | Tipo | Descrición |
|------------|------|-------------|
| HTTP Method | Enum | Método HTTP |
| Remote URL | Texto/EL | URL da API |
| SSL Context Service | CS | HTTPS |
| Send Body | Boolean | Enviar contido |
| Add Headers | Lista | Headers personalizados |
| Basic Authentication | Credenciais | Opcional |

### 4. Relacións
| Relationship | Significado |
|--------------|-------------|
| response     | API respondeu |
| success      | Procesado |
| retry        | Pode reintentarse |
| no retry     | Non reintentar |
| failure      | Erro |

### 5. Exemplo típico
GET:
```
https://api.open-meteo.com/v1/forecast?latitude=42.3&longitude=-8.7&hourly=temperature_2m
```

POST:
```
Send Body = true
Content-Type = application/json
```

### 6. Boas prácticas
- Extraer JSON con EvaluateJsonPath.
- Aumentar timeouts para APIs lentas.
- Non consultar APIs en intervalos moi curtos.

---

## 8.2. HandleHttpRequest

### 1. Descrición
Primeira metade dun microservizo HTTP en NiFi (servidor).

### 2. Función principal
- Recibir peticións HTTP.
- Crear FlowFiles desde POST/PUT.

### 3. Propiedades principais
| Propiedade | Tipo | Descrición |
|------------|------|-------------|
| Listening Port | Número | Porto escoita |
| Base Path | Texto | Ruta |
| SSL Context | CS | HTTPS |
| Authentication | Enum | Ningunha / Basic |

### 4. Relacións
| Relación | Significado |
|----------|-------------|
| success  | Petición recibida |

### 5. Exemplo
Fluxo API:
```
HandleHttpRequest → procesamento → HandleHttpResponse
```

### 6. Boas prácticas
- Usar RouteOnAttribute para clasificar peticións.
- Engadir LogAttribute para depurar.

---

## 8.3. HandleHttpResponse

### 1. Descrición
Segunda metade dun microservizo HTTP.

### 2. Función principal
- Responder ao cliente HTTP.
- Devolver JSON, texto ou códigos HTTP.

### 3. Propiedades principais
| Propiedade | Tipo | Descrición |
|------------|------|-------------|
| Status Code | Número | Código HTTP |
| Response Body | EL | Corpo resposta |
| Content-Type | Texto | Tipo MIME |

### 4. Relacións
| Relación | Significado |
|----------|-------------|
| success  | Resposta enviada |

### 5. Boas prácticas
- Sempre emparellado con HandleHttpRequest.
- Evitar loops sen resposta.

---

## 8.4. ListenHTTP

### 1. Descrición
Servidor HTTP simple para recibir POST sen resposta complexa.

### 2. Función principal
- Recepción de JSON, CSV ou ficheiros.
- Webhooks simples.

### 3. Propiedades principais
| Propiedade | Tipo | Descrición |
|------------|------|-------------|
| Port | Número | Porto |
| Base Path | Texto | Ruta |
| SSL Context | CS | HTTPS |

### 4. Relacións
| Relación | Significado |
|----------|-------------|
| success  | Petición recibida |

### 5. Boas prácticas
- Ideal para webhooks.
- Para APIs complexas → usar HandleHttpRequest/Response.

---

## 8.5. FetchHTTP

### 1. Descrición
Descarga de recursos HTTP (similar a curl).

### 2. Función principal
- Descarga de ficheiros ou JSON.
- Scraping de recursos estáticos.

### 3. Relacións
| Relación | Significado |
|----------|-------------|
| success  | Descarga correcta |
| failure  | Erro |

### 4. Boas prácticas
- Non usar en bucles moi frecuentes.
- Útil con URLs estáticas.

---

## 8.6. PostHTTP / PutHTTP

### 1. Descrición
Variantes simples de InvokeHTTP para enviar FlowFiles.

### 2. Cando usalos?
- APIs moi simples.
- Cando non se precisan múltiples relacións.

---

## Exemplo completo de API REST con NiFi

```
Cliente → HandleHttpRequest
       → ValidateRecord
       → UpdateRecord / ConvertRecord
       → PutHDFS / PutS3Object / PublishKafka
       → HandleHttpResponse → Cliente
```

---

# FIN DO DOCUMENTO HTTP
